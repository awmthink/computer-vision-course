# 迁移学习

在我们深入探讨迁移学习和微调在神经网络中的含义之前，先以乐器为例。特雷门是一种发出诡异声音的电子乐器，通常与惊悚片和恐怖电影联系在一起。它很难演奏，因为演奏者需要在空中移动双手，以控制两个天线之间的音调和音量。由于难度很大，有人发明了一种叫塔内林（又称滑音特雷门或电子特雷门）的乐器，能发出相似的声音，但更容易演奏。演奏者只需在盒子的侧面滑动到所需频率即可产生音高。不过，演奏塔内林仍然需要一定的学习曲线……当然，除非你会演奏长号。演奏长号时，你已经知道如何使用塔内林的滑动机制，因为这和长号的伸缩滑动机构是相同的。下面从左到右依次为：特雷门、塔内林和长号。

<div class="flex justify-center">
    <img src="https://huggingface.co/datasets/hf-vision/course-assets/resolve/d0096005da7fe2eb3bfbd3d0047e9ac7bd499cf0/transfer_learning.png" alt="特雷门、塔内林和长号">
<p>图1：特雷门、塔内林和长号</p>
</div>

在这种情况下，长号演奏者有效地利用了他在长号演奏中学到的知识来演奏塔内林。他将从一种乐器上学到的知识转移到另一种乐器上。我们可以在神经网络中也使用这种概念。一个神经网络在分类狗或猫时学到的知识可以用于识别其他动物。其原因在于网络在模型中学习特征的方式，也就是说，用于分类狗的特征也可以用于分类马。我们利用模型已经掌握的知识来完成不同的任务。

迁移学习要求先前的知识对新任务是“有用的”。因此，我们尝试探索的特征必须足够通用，才能适应新的应用场景。回到我们的乐器例子中，学习萨克斯而不是长号对学习塔内林的帮助就不大。长号演奏者领先的主要原因在于他对滑动位置的直观理解。

尽管如此，萨克斯演奏者也并非完全从零开始。他熟悉音乐理论、节奏和时间掌控等内容。这些通用技能让他比从未演奏过任何乐器的人更有优势。演奏乐器的过程赋予了所有演奏者一套通用的技能，这些技能在不同乐器之间都是有用的。这种跨领域的泛化（在我们的例子中是乐器）使得模型学习速度比从零训练要快得多。

## 迁移学习与微调

让我们区分一下我们所讨论的概念。长号演奏者无需训练即可演奏塔内林，他已经无意识地知道如何去演奏。萨克斯演奏者则需要一些训练来微调他的技能，以演奏塔内林。在深度学习术语中，长号演奏者使用的是一种现成的模型，这被称为迁移学习。而像萨克斯演奏者那样需要更多时间学习的模型训练则称为微调。

在微调模型时，我们不需要训练所有部分。我们可以只训练表现不佳的部分。以一个计算机视觉模型为例，它包含三个部分：[特征提取、特征增强和最终任务](https://huggingface.co/docs/transformers/main/main_classes/backbones)。在这种情况下，我们可以在不重新训练的情况下使用相同的特征提取和特征增强。因此，我们只需专注于重新训练最终任务。

如果微调最终任务后的结果不令人满意，我们仍然不需要重新训练整个特征提取部分。一个不错的折中方法是只重新训练顶层的权重。在卷积网络中，层越靠上，其特征越具备针对任务和数据集的独特性。换句话说，前几层卷积层的特征更加通用，而后面的层则更具特异性。以我们的演奏者例子来说，这相当于不浪费时间向一位经验丰富的萨克斯演奏者解释音乐理论，而只是教他如何在塔内林上改变音高。

## 关于迁移学习的考虑

我们的例子还给我们带来了一个有趣的细微差别。特雷门太难演奏，因此他们发明了一种更易演奏的乐器，且能产生相同的声音。输出几乎相同，但所需的训练时间要少得多。对于计算机视觉，我们可以先进行目标检测，以确定图像中狗的位置，然后再构建一个分类器来告诉我们狗的品种，而不是直接构建一个分类器。

最后，迁移学习并不是一种万能的性能增强工具。在我们的例子中，学习一种乐器可能有助于我们学习另一种乐器，但也可能会阻碍进步。某种乐器上的模式和习惯可能会减缓另一种乐器的进展。如果这些习惯在演奏者中根深蒂固，那么一个新手可能会在相同的训练时间内超过那个已有经验的演奏者。如果你的演奏者已经被他们的习惯所束缚，也许是时候聘请新的演奏者了。

## 迁移学习与自我训练

当没有足够的标记数据来从头训练模型时，迁移学习尤其有用。回到我们的例子，我们可以想象，若有足够的时间，一位只上过几节课的演奏者也可以通过自己演奏来进行学习，而无需教授的持续监督。在深度学习中，部分或完全自我学习被称为自我训练。它允许我们使用有标记数据（课程）和无标记数据（演奏者的自我练习）来训练模型，以掌握任务。

虽然我们不会在本节详细讨论自我训练的概念，但在这里提到它是为了提供资源给你，因为当迁移学习不起作用且标记数据稀缺时，[自我训练会非常有帮助](https://doi.org/10.48550/arXiv.2006.06882)。这些概念也并非互斥，一位有经验的演奏者可能只需几节课就能在新乐器上实现自主训练，无需监督，而事实证明我们的深度学习模型也是如此。

## 资源

- 如需了解为什么迁移学习更便宜、更快、更环保，[您可以查看课程的NLP部分第一章](https://huggingface.co/learn/nlp-course/chapter1/4?fw=pt#transfer-learning)

- [查看可用的预训练模型列表](https://huggingface.co/models)