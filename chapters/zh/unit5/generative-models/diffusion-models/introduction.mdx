# 引言到扩散模型

本章你将学到的内容：

- 什么是扩散模型以及它们与GANs的不同之处
- 扩散模型的主要子类别
- 扩散模型的应用场景
- 扩散模型的缺点

## 扩散模型及其与GANs的区别

扩散模型是计算机视觉中一个新兴且令人兴奋的领域，它在图像生成方面展示了令人印象深刻的效果。这些生成模型通过两个阶段工作：正向扩散阶段和逆向扩散阶段。首先，通过添加一些噪声对输入数据进行微小的更改，然后尝试还原这些更改以回到原始数据。这种更改和还原的过程帮助生成了逼真的图像。

这些生成模型在生成建模领域设立了新的标准，特别是指像 [Imagen](https://imagen.research.google/) 和 [Latent Diffusion Models](https://arxiv.org/abs/2112.10752)(LDMs) 这样的模型。以下是通过这些模型生成的图像示例。

<div class="flex justify-center">
    <img src="https://huggingface.co/datasets/hwaseem04/Documentation-files/resolve/main/CV-Course/diffusion-eg.png" alt="使用扩散模型生成的示例图像">
<p>图1：使用扩散模型生成的示例图像</p>
</div>

在扩散模型兴起之前，许多人认为GANs在生成样本的质量方面是最先进的生成模型。GANs也因其对抗性目标而训练困难，并且经常遇到模式崩溃的问题。可以将不同模式视为不同类别。例如，将猫和狗视为两个独立的模式。如果生成器的任务是生成猫和狗的图像，当发生模式崩溃时，这意味着生成器只生成可能的猫或狗的图像。这种情况的原因之一是判别器未能脱离局部极小值，导致反复地只将某一模式（猫或狗）分类为假。在对比下，扩散模型具有稳定的训练过程，并因基于似然的方式而提供更多的多样性。

然而，由于逐步的逆向过程，扩散模型通常计算密集，并且在推理时间上比GANs更长。

在科学中，扩散是溶质颗粒从高浓度区域向低浓度区域移动的过程。考虑以下扩散的类比以获得高层次的直观理解：

<div class="flex justify-center">
    <img src="https://huggingface.co/datasets/hwaseem04/Documentation-files/resolve/main/CV-Course/diffusion-intuition.jpeg" alt="扩散类比-水中的墨水滴">
<p>图2：扩散类比-水中的墨水滴</p>
</div>

上图展示的是传统的扩散过程，当墨水滴入清水杯中，经过一段时间后会完全融入。实际上，逆转这一过程，即从混合物中取出墨水滴是不可能的。但这正是扩散模型所做的，即去除噪声并生成干净的图像。

在扩散模型中，高斯噪声逐步添加到训练图像中，使它们最终变成完全杂乱的噪声图像。通过这一过程，模型逐步学习去除噪声，因此可以将任何高斯噪声图像转化为新的多样图像（也可以根据文本提示进行条件生成）。

<div class="flex justify-center">
    <img src="https://huggingface.co/datasets/hwaseem04/Documentation-files/resolve/main/CV-Course/diffusion-process.jpg" alt="逆向过程">
<p>图3：逆向过程</p>
</div>

## 扩散模型的主要变体

扩散模型有三大框架：

- 去噪扩散概率模型（DDPMs）：
	- DDPMs使用潜变量来估计概率分布。从这个角度看，DDPMs可以视为一种特殊的变分自编码器（VAEs），其中正向扩散阶段对应于VAE中的编码过程，而逆向扩散阶段对应于解码过程。
- 噪声条件评分网络（NCSNs）：
	- 基于通过评分匹配训练共享神经网络以估计扰动数据分布在不同噪声水平的评分函数（定义为对数密度的梯度）。
- 随机微分方程（SDEs）：
	- 它表示一种建模扩散的替代方法，构成了扩散模型的第三个子类别。通过正向和逆向SDEs建模扩散，提供了高效的生成策略以及强大的理论结果。这可以视为DDPMs和NCSNs的广义化。

<div class="flex justify-center">
    <img src="https://huggingface.co/datasets/hwaseem04/Documentation-files/resolve/main/CV-Course/diffusion-sub-categories.png" alt="扩散的子类别">
<p>图4：扩散的子类别</p>
</div>

## 扩散模型的应用场景

扩散模型应用于多种任务，包括但不限于：

- 图像生成 - 根据提示生成图像。
- 图像超分辨率 - 提升图像分辨率。
- 图像修复 - 根据提示填补图像中受损的部分。
- 图像编辑 - 编辑图像的特定/全部部分而不丢失其视觉识别性。
- 图像到图像的翻译 - 包括更改背景、位置属性等。
- 从扩散模型中学习的潜在表示也可用于：
    - 图像分割
    - 分类
    - 异常检测

想要体验扩散模型？不用担心，Hugging Face的 [Diffusers](https://huggingface.co/docs/diffusers/index) 库提供了几乎所有最近的扩散SOTA模型，可以用于几乎任何任务。

## 扩散模型的缺点

扩散模型的最大缺点仍然是需要在推理时执行多个步骤才能生成一个样本。[潜在一致性模型](https://latent-consistency-models.github.io/)(LCMs) 是为克服潜在扩散模型（LDMs）缓慢的迭代采样过程而提出的研究方向，通过最少的步骤在任何预训练的LDMs（例如稳定扩散）上实现快速推理。尽管在这方面进行了大量研究，GANs仍然在生成图像的速度上更快。

扩散模型的其他问题可以与使用CLIP嵌入进行文本到图像生成的常用策略相关。一些文献指出，这些模型在生成图像中可读文本时表现困难，并解释这种行为是因为CLIP嵌入不包含拼写信息。